require 'rails_helper'

RSpec.describe SessionsController, type: :controller do

  describe "POST #create" do
    let :user do
      { :email => 'b@mail.com', :password => '1234' }
    end
    before(:each) do
      @user = User.create(name: "Beez", email: "b@mail.com", password: "1234", password_confirmation: "1234")
    end

    # it "session key is user_id" do
    # end

    it "redirect_to user_path" do
      @user = User.find_by(email: "b@mail.com")
      post :create, session: { :email => 'b@mail.com', :password => '1234' }
      expect(response).to redirect_to(user_path(@user.id))
    end
  end

  describe "DELETE #destroy" do
    before(:each) do
        @user =   User.find_by(email: "e@mail.com")
        session[:user_id] = @user.id
      end

    it "redirect_to root_path" do
      delete :destroy, session[:user_id] = @user.id
      expect(response).to redirect_to(root_path)
    end

  end # DELETE

  describe "private methods" do
    context "#find_user" do
      it "returns a user instance" do
        find_user(email: "e@mail.com")

        expect(@user.name).to eq("Elia")
      end

    end # context

    context "#session_params" do
      params = [:email, :password, :user_id]

      params.each do |param|
        it "can access the #{param}" do

        end
      end
    end # context

  end # describe private methods

end
